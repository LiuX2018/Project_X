<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of importZemaxFile</title>
  <meta name="keywords" content="importZemaxFile">
  <meta name="description" content="importZemaxFile: imports lens data from .zmx file format generated by zemax.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # AODParentDir --><!-- menu.html Import_Export_Module -->
<h1>importZemaxFile
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>importZemaxFile: imports lens data from .zmx file format generated by zemax.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function opticalSystemObject = importZemaxFile (zmxFullFileName) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> importZemaxFile: imports lens data from .zmx file format generated by zemax. 
 when unsupported feature is found, display the command in the command window.
 Input:
     zmxFullFileName: Full file name of .zmx file including its path.
 Output:
    opticalSystemObject: Optical system object</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../AODParentDir/Class_Definition/@Glass/Glass.html" class="code" title="">Glass</a>	</li><li><a href="../../AODParentDir/Class_Definition/@OpticalSystem/OpticalSystem.html" class="code" title="">OpticalSystem</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../AODParentDir/Class_Definition/@AODParentWindow/openFromZemaxFile.html" class="code" title="function [ opened ] = openFromZemaxFile(parentWindow,zmxFullFileName)">openFromZemaxFile</a>	openFromZemaxFile: Imports and opens zmx files. The function 'importZemaxFile'</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function nextLine =  readNextLine(inputFile,skippedLine)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function opticalSystemObject = importZemaxFile (zmxFullFileName)</a>
0002     <span class="comment">% importZemaxFile: imports lens data from .zmx file format generated by zemax.</span>
0003     <span class="comment">% when unsupported feature is found, display the command in the command window.</span>
0004     <span class="comment">% Input:</span>
0005     <span class="comment">%     zmxFullFileName: Full file name of .zmx file including its path.</span>
0006     <span class="comment">% Output:</span>
0007     <span class="comment">%    opticalSystemObject: Optical system object</span>
0008 
0009 
0010    <span class="comment">% &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Algorithm Section&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
0011     <span class="comment">% NB: The commnts are based on old version (9.0) of the .zmx file format and</span>
0012     <span class="comment">% shall be corrected with the new format.</span>
0013 
0014     <span class="comment">% &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Example Usage&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
0015     <span class="comment">%</span>
0016 
0017     <span class="comment">% &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Author Section &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
0018     <span class="comment">%   Written By: Worku, Norman Girma</span>
0019     <span class="comment">%   Advisor: Prof. Herbert Gross</span>
0020     <span class="comment">%   Part of the RAYTRACE_TOOLBOX V3.0 (OOP Version)</span>
0021     <span class="comment">%    Optical System Design and Simulation Research Group</span>
0022     <span class="comment">%   Institute of Applied Physics</span>
0023     <span class="comment">%   Friedrich-Schiller-University of Jena</span>
0024                              
0025     <span class="comment">% &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Change History Section &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
0026     <span class="comment">% Date----------Modified By ---------Modification Detail--------Remark</span>
0027     <span class="comment">% Oct 14,2013   Worku, Norman G.     Original Version       Version 3.0</span>
0028 
0029     <span class="comment">% &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; Main Code Section &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
0030 
0031     <span class="comment">% create an empty optical system object</span>
0032     mySystem = <a href="../../AODParentDir/Class_Definition/@OpticalSystem/OpticalSystem.html" class="code" title="">OpticalSystem</a>;
0033     nSurf = 0;
0034     <span class="comment">% convert unicode to ascii format running DOS command</span>
0035     command = [<span class="string">'TYPE &quot;'</span>,zmxFullFileName,<span class="string">'&quot;&gt;&quot;temAnsiFile&quot;'</span>]
0036     status = dos(command);
0037     <span class="comment">% read the input file</span>
0038     inputFile = fopen(<span class="string">'temAnsiFile'</span>, <span class="string">'r'</span>);
0039       
0040     <span class="comment">% locate the beginning of the file</span>
0041      currentPos = ftell(inputFile);
0042 
0043     <span class="comment">% read the next valid line</span>
0044     skippedLine = 0;
0045     currentLine = <a href="#_sub1" class="code" title="subfunction nextLine =  readNextLine(inputFile,skippedLine)">readNextLine</a>(inputFile,skippedLine);
0046     
0047     <span class="keyword">while</span> ( ~strcmpi(currentLine,<span class="string">'EOF'</span>) )
0048         <span class="comment">% read the line as space separated string</span>
0049         currentLineArray = strread(currentLine,<span class="string">'%s'</span>);
0050 
0051         <span class="comment">% The first element of the array is the 4 character zmx command</span>
0052         zmxCommand = char(currentLineArray(1,:));
0053 
0054         <span class="keyword">switch</span> zmxCommand
0055             <span class="keyword">case</span> <span class="string">'APLA'</span> <span class="comment">% APLA: Curvature aplanatic solve</span>
0056                 disp(<span class="string">'Aplanatic surfaces not supported!!'</span>);
0057             <span class="keyword">case</span> <span class="string">'CHIA'</span> <span class="comment">% CHIA val: Curvature chief ray angle solve value</span>
0058                 disp(<span class="string">'Solves surfaces not supported!!'</span>);
0059             <span class="keyword">case</span> <span class="string">'CHZH'</span> <span class="comment">% CHZH hgt Thickness chief ray height solve.</span>
0060                 disp(<span class="string">'Solves surfaces not supported!!'</span>);
0061             <span class="keyword">case</span> <span class="string">'CLAP'</span> <span class="comment">% CLAP min max Circular aperture min max</span>
0062                 disp(<span class="string">'Min Max aperture not supported!!'</span>);
0063             <span class="keyword">case</span> <span class="string">'CNOR'</span> <span class="comment">% CNOR Curvature chief ray normal.</span>
0064                 disp(<span class="string">'Curvature chief ray normal surfaces not supported!!'</span>);
0065             <span class="keyword">case</span> <span class="string">'COAT'</span> <span class="comment">% COAT The name of the coating used by the surface, if any.</span>
0066                 <span class="comment">% read the coating name</span>
0067                 coatName = char(currentLineArray(2,:));
0068                 <span class="comment">% import coating object</span>
0069                 disp(<span class="string">'Coating import not supported!!'</span>);
0070             <span class="keyword">case</span> <span class="string">'COMM'</span> <span class="comment">% COMM Comment for the current surface.</span>
0071                 <span class="comment">% comment starts from 5th place</span>
0072                 mySystem.SurfaceArray(surfIndex+1).Comment = currentLine(5:length(currentLine));
0073 
0074             <span class="keyword">case</span> <span class="string">'CONI'</span> <span class="comment">% CONI val Conic constant</span>
0075                 <span class="comment">% the second element is conic constant of current surface</span>
0076                 k = str2num(char(currentLineArray(2,:)));
0077                 mySystem.SurfaceArray(surfIndex+1).Conic = k;
0078                 <span class="comment">% set surface type</span>
0079                 <span class="keyword">if</span> k ~= 0
0080                     mySystem.SurfaceArray(surfIndex+1).Type = <span class="string">'Conic Aspherical'</span>;
0081                 <span class="keyword">end</span>
0082 
0083 
0084             <span class="keyword">case</span> <span class="string">'CURV'</span> <span class="comment">% CURV val solvetype param1 param2 The curvature value of a surface.</span>
0085                         <span class="comment">% The solvetype is an integer code that indicates the type of solve,</span>
0086                         <span class="comment">% and the two following parameters are the solve parameters.</span>
0087                 radius = 1/(str2num(char(currentLineArray(2,:))));
0088                 mySystem.SurfaceArray(surfIndex+1).Radius = radius;
0089 <span class="comment">%                 if abs(radius) &lt; 10^10</span>
0090 <span class="comment">%                     % set the semidiameter and apperture value from the radius</span>
0091 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).ApertureType = 'Circular';</span>
0092 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).ApertureParameter(1) = abs(radius - 0.05*radius);</span>
0093 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).SemiDiameter =  abs(radius - 0.05*radius);</span>
0094 <span class="comment">%                 else</span>
0095                     <span class="comment">% set the semidiameter and apperture value to fixed</span>
0096                     <span class="comment">% value 1</span>
0097 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).ApertureType = 'Circular';</span>
0098 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).ApertureParameter(1) = 1;</span>
0099 <span class="comment">%                     mySystem.SurfaceArray(surfIndex+1).SemiDiameter = 1;</span>
0100 <span class="comment">%                end</span>
0101 
0102                 <span class="comment">% set surface type</span>
0103                 <span class="keyword">if</span> radius &lt; 10^10
0104                     mySystem.SurfaceArray(surfIndex+1).Type = <span class="string">'Spherical'</span>;
0105                 <span class="keyword">end</span>
0106 
0107                 <span class="comment">% ignore solve for current version</span>
0108                 disp(<span class="string">'Solves not supported!!'</span>);
0109             <span class="keyword">case</span> <span class="string">'DIAM'</span> <span class="comment">% DIAM val solvecode pusurf The semi-diameter of a surface.</span>
0110                         <span class="comment">% The solvecode is 0 for automatic, 1 for fixed, 2 for pickup</span>
0111                         <span class="comment">% and 3 for maximum. The pusurf value is only required for solvecode = 2.</span>
0112                 semiDiam = (str2num(char(currentLineArray(2,:))));
0113                 <span class="keyword">if</span> isnan(semiDiam)
0114                     mySystem.SurfaceArray(surfIndex+1).ApertureType = <span class="string">'Circular'</span>;
0115                     mySystem.SurfaceArray(surfIndex+1).ApertureParameter(1) = 1;
0116                     mySystem.SurfaceArray(surfIndex+1).SemiDiameter = 1; 
0117                 <span class="keyword">else</span>
0118                     mySystem.SurfaceArray(surfIndex+1).ApertureType = <span class="string">'Circular'</span>;
0119                     mySystem.SurfaceArray(surfIndex+1).ApertureParameter(1) = semiDiam;
0120                     mySystem.SurfaceArray(surfIndex+1).SemiDiameter = semiDiam;
0121                 <span class="keyword">end</span>
0122                 <span class="comment">% ignore solve for current version</span>
0123                 disp(<span class="string">'Solves not supported!!'</span>);
0124             <span class="keyword">case</span> <span class="string">'DISZ'</span> <span class="comment">% DISZ val The Z thickness of a surface</span>
0125                 <span class="keyword">if</span> strcmpi(char(currentLineArray(2,:)),<span class="string">'INFINITY'</span>)
0126                     mySystem.SurfaceArray(surfIndex+1).Thickness = Inf;
0127                 <span class="keyword">else</span>
0128                     mySystem.SurfaceArray(surfIndex+1).Thickness = (str2num(char(currentLineArray(2,:))));
0129                 <span class="keyword">end</span>
0130             <span class="keyword">case</span> <span class="string">'EDGE'</span> <span class="comment">% EDGE thi rad Thickness edge thickness solve.</span>
0131                 disp(<span class="string">'Edge thickness not supported!!'</span>);
0132             <span class="keyword">case</span> <span class="string">'ELAP'</span> <span class="comment">% ELAP xwid ywid Elliptical aperture.</span>
0133                 disp(<span class="string">'Ellipse aperture not supported!!'</span>);
0134             <span class="keyword">case</span> <span class="string">'ELOB'</span> <span class="comment">% ELOB xwid ywid Elliptical obscuration.</span>
0135                 disp(<span class="string">'Ellipse aperture not supported!!'</span>);
0136             <span class="keyword">case</span> <span class="string">'ENPD'</span> <span class="comment">% ENPD val Entrance pupil diameter value.</span>
0137                 mySystem.SystemApertureType = 1;
0138                 mySystem.SystemApertureValue = (str2num(char(currentLineArray(2,:))));
0139             <span class="keyword">case</span> <span class="string">'ENVD'</span> <span class="comment">% ENVD temp pres Environment data. The temp and pres values are in</span>
0140                         <span class="comment">% degrees c and atmospheres, respectively.</span>
0141                 disp(<span class="string">'Environment data is not supported!!'</span>);        
0142             <span class="keyword">case</span> <span class="string">'FLAP'</span> <span class="comment">% FLAP Floating aperture.</span>
0143                 disp(<span class="string">'Floating aperture is not supported!!'</span>);
0144             <span class="keyword">case</span> <span class="string">'FLOA'</span> <span class="comment">% FLOA val Float by stop size. The val argument is ignored</span>
0145                 disp(<span class="string">'Floating by stop size is not supported!!'</span>);
0146             <span class="keyword">case</span> <span class="string">'FNUM'</span> <span class="comment">% FNUM val Image space F/# value</span>
0147                 disp(<span class="string">'Image space F/# value is not supported!!'</span>);
0148             <span class="keyword">case</span> <span class="string">'FTYP'</span> <span class="comment">% FTYP i Field type. The integer i is 0, 1, or 2 for field angle,</span>
0149                     <span class="comment">% object height, or image height</span>
0150                 mySystem.FieldType = (str2num(char(currentLineArray(2,:)))+1);
0151                 <span class="keyword">if</span> str2num(char(currentLineArray(2,:)))==2
0152                     disp(<span class="string">'Image height field value is not supported!!'</span>);
0153                 <span class="keyword">end</span>
0154             <span class="keyword">case</span> <span class="string">'FWGT'</span> <span class="comment">% FWGT val1 val2 val3... The field weights. See XFLD</span>
0155                 ss = size(currentLineArray);
0156                 nFieldPoint = ss(1)-1; <span class="comment">% number of field points defined</span>
0157                 mySystem.NumberOfFieldPoints = nFieldPoint;
0158                 mySystem.FieldPointMatrix(:,1)= str2num((currentLineArray(2:ss(1)))');
0159 
0160                 <span class="comment">% record  weight of each field points</span>
0161                 <span class="comment">%for kk = 1:1:nFields</span>
0162                 <span class="comment">%    mySystem.FieldPointMatrix(kk,3) = (str2num(currentLineArray(kk+1));</span>
0163                 <span class="comment">%end</span>
0164             <span class="keyword">case</span> <span class="string">'GARR'</span> <span class="comment">% GARR i sag dx dy dxdy Used for defining the grid surface data. &quot;i&quot; is the array</span>
0165                     <span class="comment">% index, starting at 0. The other values are the sag, the</span>
0166                     <span class="comment">% derivative of the sag in the x direction, the derivative</span>
0167                     <span class="comment">% of the sag in the y direction, and the second cross</span>
0168                     <span class="comment">% derivative. Must follow after the GDAT command</span>
0169                 disp(<span class="string">'Grid surface is not supported!!'</span>);
0170             <span class="keyword">case</span> <span class="string">'GCAT'</span> <span class="comment">% GCAT name1 name2 name3 ... Indicates which glass catalogs are used by the lens.</span>
0171                 ss = size(currentLineArray);
0172                 nGlassCat = ss(1)-1; <span class="comment">% number of glass catalogues used</span>
0173                 <span class="keyword">if</span> nGlassCat &gt; 1||~strcmpi(char(currentLineArray(2,:)),<span class="string">'Schott'</span>)
0174                     disp(<span class="string">'Catalogues other than Schott are not supported!!'</span>);
0175                 <span class="keyword">else</span>
0176 
0177                 <span class="keyword">end</span>
0178             <span class="keyword">case</span> <span class="string">'GDAT'</span> <span class="comment">% GDAT ix iy dx dy Defines the grid data header for the surface. The</span>
0179                     <span class="comment">% values are the number of x and y pixels, and the delta</span>
0180                     <span class="comment">% x increment and delta y increment</span>
0181                 disp(<span class="string">'Image height field value is not supported!!'</span>);
0182             <span class="keyword">case</span> <span class="string">'GFAC'</span> <span class="comment">% GFAC val type Apodization factor value and type. The type code is 0</span>
0183                     <span class="comment">% for none, 1 for Gaussian, and 2 for tangential.</span>
0184                 disp(<span class="string">'GFAC is not supported!!'</span>);
0185             <span class="keyword">case</span> <span class="string">'GLAS'</span> <span class="comment">% GLAS name code pu nd vd pd vnd vvd vpd io ao The glass of the surface.</span>
0186                     <span class="comment">% Name is the glass name,such as BK7. Code is 0 for fixed, 1 for model,</span>
0187                     <span class="comment">% 2 for pickup. Pu is the pickup surface, which must be supplied even if the</span>
0188                     <span class="comment">% solve is not a pickup. nd, vd, and pd are the index, abbe, and partial dispersion</span>
0189                     <span class="comment">% values, which are only used if the glass is a model. The vnd,vvd, and vpd codes</span>
0190                     <span class="comment">% are 0 if that parameter is variable, else they are unity. The io and ao values are</span>
0191                     <span class="comment">% the index and Abbe offsets respectively, which are used primarily for tolerancing.</span>
0192                     <span class="comment">% A glass name must be supplied, even if the glass is a model glass</span>
0193                     <span class="comment">% extract the schott glass from glass catalogue of the system</span>
0194 
0195                     glassName = char(currentLineArray(2,:));
0196                     load(<span class="string">'f:\aoe_schott_optical_glass_catalogue_excel_april_2013.xls.mat'</span>,<span class="string">'AllGlass'</span>);
0197 
0198                     location = find(strcmpi({AllGlass.Name},glassName));
0199                     <span class="keyword">if</span> ~isempty(location)
0200                       <span class="comment">% File exists.  Do stuff....</span>
0201                         mySystem.SurfaceArray(surfIndex+1).Glass = AllGlass(location);
0202                     <span class="keyword">else</span>
0203                       <span class="comment">% File does not exist.</span>
0204                       msgbox ([glassName,<span class="string">' : The glass file does not exsist in the catalogue. So it is set to default 1.5 glass'</span>]);
0205                       glasName = <span class="string">'FixedIndexGlass'</span>;
0206                       sellCoeff = [1.5 0 0 0 0 0];                      
0207                       mySystem.SurfaceArray(surfIndex+1).Glass = <a href="../../AODParentDir/Class_Definition/@Glass/Glass.html" class="code" title="">Glass</a>(glasName,sellCoeff); 
0208                     <span class="keyword">end</span>            
0209 
0210             <span class="keyword">case</span> <span class="string">'GLRS'</span> <span class="comment">% GLRS surf Global coordinate reference surface.</span>
0211                 disp(<span class="string">'GFAC is not supported!!'</span>);
0212             <span class="keyword">case</span> <span class="string">'HIDE'</span> <span class="comment">% HIDE Hide rays to/from surface flag.</span>
0213                 disp(<span class="string">'GFAC is not supported!!'</span>);
0214             <span class="keyword">case</span> <span class="string">'MARA'</span> <span class="comment">% MARA val Curvature marginal ray angle solve value.</span>
0215                 disp(<span class="string">'GFAC is not supported!!'</span>);
0216             <span class="keyword">case</span> <span class="string">'MAZH'</span> <span class="comment">% MAZH hgt zone Thickness marginal ray height solve.</span>
0217                 disp(<span class="string">'GFAC is not supported!!'</span>);
0218             <span class="keyword">case</span> <span class="string">'MNOR'</span> <span class="comment">% MNOR Curvature marginal ray normal.</span>
0219                 disp(<span class="string">'GFAC is not supported!!'</span>);
0220             <span class="keyword">case</span> <span class="string">'MNUM'</span> <span class="comment">% MNUM n Number of configurations.</span>
0221                 disp(<span class="string">'GFAC is not supported!!'</span>);
0222             <span class="keyword">case</span> <span class="string">'NAME'</span> <span class="comment">% NAME string... Indicates the &quot;lens name&quot; description.</span>
0223                 mySystem.LensName = currentLine(5:length(currentLine));
0224             <span class="keyword">case</span> <span class="string">'NOTE'</span> <span class="comment">% NOTE i string Lens notes. &quot;i&quot; should be between 1 and 3, inclusive,</span>
0225                     <span class="comment">% and the string can be any text.</span>
0226                 mySystem.LensNote = currentLine(5:length(currentLine));
0227             <span class="keyword">case</span> <span class="string">'OBDC'</span> <span class="comment">% OBDC xdec ydec Obscuration and aperture decenter x and decenter y.</span>
0228                 disp(<span class="string">'OBDC is not supported!!'</span>);
0229             <span class="keyword">case</span> <span class="string">'OBNA'</span> <span class="comment">% OBNA val Object space numerical aperture value.</span>
0230                 mySystem.SystemApertureType = 2;
0231                 mySystem.SystemApertureValue = (str2num(char(currentLineArray(2,:))));
0232             <span class="keyword">case</span> <span class="string">'OBSC'</span> <span class="comment">% OBSC min max Circular obscuration min max.</span>
0233                 disp(<span class="string">'OBSC is not supported!!'</span>);
0234             <span class="keyword">case</span> <span class="string">'OPDZ'</span> <span class="comment">% OPDZ opd zone Thickness OPD solve.</span>
0235                 disp(<span class="string">'OPDZ is not supported!!'</span>);
0236             <span class="keyword">case</span> <span class="string">'PARM'</span> <span class="comment">% PARM n val Parameter n is the value of &quot;val&quot;.</span>
0237                 disp(<span class="string">'PARM is not supported!!'</span>);
0238             <span class="keyword">case</span> <span class="string">'PCUP'</span> <span class="comment">% PCUP n val Curvature pickup solve from surface n times val</span>
0239                 disp(<span class="string">'PCUP is not supported!!'</span>);
0240             <span class="keyword">case</span> <span class="string">'PICB'</span> <span class="comment">% PICB i Paraxial Ignore Coordinate Breaks, i = 0 is false, i = 1</span>
0241                     <span class="comment">% is true. Default is true.</span>
0242                 disp(<span class="string">'PICB is not supported!!'</span>);
0243             <span class="keyword">case</span> <span class="string">'PKUP'</span> <span class="comment">% PKUP n val Conic pickup from surface n times val.</span>
0244                 disp(<span class="string">'PKUP is not supported!!'</span>);
0245             <span class="keyword">case</span> <span class="string">'POLS'</span> <span class="comment">% POLS nUnpol Ex Ey Phax Phay Default polarization state data.</span>
0246                 disp(<span class="string">'POLS is not supported!!'</span>);
0247             <span class="keyword">case</span> <span class="string">'PPAR'</span> <span class="comment">% PPAR i n val Parameter i pickup from n times val.</span>
0248                 disp(<span class="string">'PPAR is not supported!!'</span>);
0249             <span class="keyword">case</span> <span class="string">'PUSH'</span> <span class="comment">% PUSH val Pupil Shift. Used only if ray aiming is on. The &quot;val&quot; is</span>
0250                     <span class="comment">% in lens units.</span>
0251                 disp(<span class="string">'PUSH is not supported!!'</span>);
0252             <span class="keyword">case</span> <span class="string">'PWAV'</span> <span class="comment">% PWAV n The primary wavelength indicator.</span>
0253                 mySystem.PrimaryWavelengthIndex = str2num(char(currentLineArray(2,:)));
0254             <span class="keyword">case</span> <span class="string">'PZUP'</span> <span class="comment">% PZUP n val Thickness pickup from n times val.</span>
0255                 disp(<span class="string">'PZUP is not supported!!'</span>);
0256             <span class="keyword">case</span> <span class="string">'RADI'</span> <span class="comment">% RADI val The radius of curvature. Now obsolete, use CURV.</span>
0257                 disp(<span class="string">'RADI is not supported!!'</span>);
0258             <span class="keyword">case</span> <span class="string">'RAIM'</span> <span class="comment">% RAIM tol type fastasphere usecache grinaper robust The ray aiming and a</span>
0259                     <span class="comment">% few other settings on the advanced box are controlled by this command.</span>
0260                     <span class="comment">% Tol is no longer used, but some value (such as zero) must be present as a</span>
0261                     <span class="comment">% placeholder. Type is 0, 1, or 2 for None, Paraxial, or Real ray aiming.</span>
0262                     <span class="comment">% Fastasphere is 1 if the &quot;Fast Asphere Trace&quot; is selected, otherwise it is 0.</span>
0263                     <span class="comment">% Usecache is 1 if &quot;Use Ray Aiming Cache&quot; is selected, otherwise it is 0.</span>
0264                     <span class="comment">% Grinaper is 1 if &quot;Check Grin Aper&quot; is selected, otherwise it is 0.</span>
0265                     <span class="comment">% Robust is 1 if &quot;Robust Ray Aiming&quot; is selected, otherwise it is 0.</span>
0266                 disp(<span class="string">'RAIM is not supported!!'</span>);
0267             <span class="keyword">case</span> <span class="string">'ROPD'</span> <span class="comment">% ROPD i Reference OPD setting. For i = 0, 1, and 2, the</span>
0268                     <span class="comment">% reference point is Absolute, Infinity, and Exit Pupil,</span>
0269                     <span class="comment">% respectively. Use Exit Pupil as the default.</span>
0270                 disp(<span class="string">'ROPD is not supported!!'</span>);
0271             <span class="keyword">case</span> <span class="string">'SDMA'</span> <span class="comment">% SDMA margin fast_semi_diameters Semi-diameter margin, and fast semi-diameter mode flag.</span>
0272                 disp(<span class="string">'ROPD is not supported!!'</span>);
0273             <span class="keyword">case</span> <span class="string">'SLAB'</span> <span class="comment">% SLAB int Surface label. This is a unique integer ZEMAX</span>
0274                     <span class="comment">% assigns to each surface to identify the surface as new</span>
0275                     <span class="comment">% surfaces are inserted or old ones deleted. Some</span>
0276                     <span class="comment">% features that depend upon knowing where a surface</span>
0277                     <span class="comment">% has moved to in the list of surfaces use this label to</span>
0278                     <span class="comment">% keep track of the renumbered surfaces.</span>
0279 
0280             <span class="keyword">case</span> <span class="string">'SPID'</span> <span class="comment">% SPID numarms width Spider aperture.</span>
0281                 disp(<span class="string">'SPID is not supported!!'</span>);
0282             <span class="keyword">case</span> <span class="string">'SQAP'</span> <span class="comment">% SQAP xwid ywid Rectangular aperture.</span>
0283                 disp(<span class="string">'SQAP is not supported!!'</span>);
0284             <span class="keyword">case</span> <span class="string">'SQOB'</span> <span class="comment">% SQOB xwid ywid Rectangular obscuration.</span>
0285                 disp(<span class="string">'SQOB is not supported!!'</span>);
0286 
0287             <span class="keyword">case</span> <span class="string">'STOP'</span> <span class="comment">% STOP Indicates the current surface is the stop surface.</span>
0288                 mySystem.SurfaceArray(surfIndex+1).Stop = 1;
0289             <span class="keyword">case</span> <span class="string">'SURF'</span> <span class="comment">% SURF Increments the surface counter.</span>
0290                 surfIndex = str2num(char(currentLineArray(2,:)));
0291                 nSurf = nSurf + 1;          
0292                 
0293             <span class="keyword">case</span> <span class="string">'TCED'</span> <span class="comment">% TCED val v TCE value of surface. v is unity if variable, else 0.</span>
0294                 disp(<span class="string">'TCED is not supported!!'</span>);
0295             <span class="keyword">case</span> <span class="string">'TCOC'</span> <span class="comment">% TCOC surf Thickness center of curvature solve.</span>
0296                 disp(<span class="string">'TCOC is not supported!!'</span>);
0297             <span class="keyword">case</span> <span class="string">'TCOM'</span> <span class="comment">% TCOM surf thickness Thickness compensator solve.</span>
0298                 disp(<span class="string">'TCOM is not supported!!'</span>);
0299             <span class="keyword">case</span> <span class="string">'TOLE'</span> <span class="comment">% TOLE n length Thickness position solve.</span>
0300                 disp(<span class="string">'TOLE is not supported!!'</span>);
0301             <span class="keyword">case</span> <span class="string">'TYPE'</span> <span class="comment">% TYPE codename Indicates the current surface type. The codenames</span>
0302                     <span class="comment">% are listed in a following section.</span>
0303                 <span class="comment">% switch char(currentLineArray(2,:))</span>
0304                     <span class="comment">% case 'STANDARD'</span>
0305                     <span class="comment">% otherwise</span>
0306 
0307                 <span class="comment">% end</span>
0308                 <span class="comment">% For now make the surface type Plane and then change to spherical if rad~=inf,</span>
0309                 <span class="comment">% and then to aspheric if conic constant is ~= 0</span>
0310                 mySystem.SurfaceArray(surfIndex+1).Type = <span class="string">'Plane'</span>;
0311             <span class="keyword">case</span> <span class="string">'UDAD'</span> <span class="comment">% UDAD x y User defined aperture data x and y.</span>
0312                 disp(<span class="string">'UDAD is not supported!!'</span>);
0313             <span class="keyword">case</span> <span class="string">''</span> <span class="comment">% UNIT code Specifies the lens units. The &quot;code&quot; must be either</span>
0314                     <span class="comment">% MM, CM, IN, or METER.</span>
0315 
0316             <span class="keyword">case</span> <span class="string">'USAP'</span> <span class="comment">% USAP min max User defined aperture min max.</span>
0317                 disp(<span class="string">'USAP is not supported!!'</span>);
0318             <span class="keyword">case</span> <span class="string">'USOB'</span> <span class="comment">% USOB min max User defined obscuration min max.</span>
0319                 disp(<span class="string">'USOB is not supported!!'</span>);
0320             <span class="keyword">case</span> <span class="string">'VCON'</span> <span class="comment">% VCON Conic is variable.</span>
0321                 disp(<span class="string">'VCON is not supported!!'</span>);
0322             <span class="keyword">case</span> <span class="string">'VCUR'</span> <span class="comment">% VCUR Curvature is variable.</span>
0323                 disp(<span class="string">'VCUR is not supported!!'</span>);
0324             <span class="keyword">case</span> <span class="string">'VDSZ'</span> <span class="comment">% VDSZ Thickness is variable.</span>
0325                 disp(<span class="string">'VDSZ is not supported!!'</span>);
0326             <span class="keyword">case</span> <span class="string">'VERS'</span> <span class="comment">% VERS n The version number of ZEMAX that created the file.</span>
0327                 disp(<span class="string">'VERS is not supported!!'</span>);
0328             <span class="keyword">case</span> <span class="string">'VPAR'</span> <span class="comment">% VPAR n Parameter n is variable</span>
0329                 disp(<span class="string">'VPAR is not supported!!'</span>);
0330             <span class="keyword">case</span> <span class="string">'WAVL'</span> <span class="comment">% WAVL val1 val2 val3... The wavelength values in microns.</span>
0331                 ss = size(currentLineArray);
0332                 nWavelength = ss(1)-1; <span class="comment">% number of wavelengths defined</span>
0333                 mySystem.NumberOfWavelengths = nWavelength;
0334                 mySystem.WavelengthMatrix(:,1)= str2num((currentLineArray(2:ss(1)))');
0335             <span class="keyword">case</span> <span class="string">'WWGT'</span> <span class="comment">% WWGT val1 val2 val3... The wavelength weights.</span>
0336                 ss = size(currentLineArray);
0337                 nWavelength = ss(1)-1; <span class="comment">% number of wavelengths defined</span>
0338                 mySystem.NumberOfWavelengths = nWavelength;
0339                 mySystem.WavelengthMatrix(:,2)= str2num((currentLineArray(2:ss(1)))');
0340             <span class="keyword">case</span> <span class="string">'XDAT'</span> <span class="comment">% XDAT n val v pus sca Extra Data Parameter n has value val. If v is unity, then</span>
0341                     <span class="comment">% the value is variable. If v is 2, then there is a pickup</span>
0342                     <span class="comment">% solve on the extra data parameter. The pickup surface</span>
0343                     <span class="comment">% number is pus and the scale factor is sca.</span>
0344                 disp(<span class="string">'XDAT is not supported!!'</span>);
0345             <span class="keyword">case</span> <span class="string">'XFLD'</span> <span class="comment">% XFLD val1 val2 val3... The x-field values. There are from 1 to 12 values</span>
0346                     <span class="comment">% separated by spaces. The units depend upon the field</span>
0347                     <span class="comment">% type, either degrees or lens units.</span>
0348                 ss = size(currentLineArray);
0349                 nFieldPoint = ss(1)-1; <span class="comment">% number of field points defined</span>
0350                 mySystem.NumberOfFieldPoints = nFieldPoint;
0351                 mySystem.FieldPointMatrix(:,1)= str2num((currentLineArray(2:ss(1)))');
0352             <span class="keyword">case</span> <span class="string">'YFLD'</span> <span class="comment">% YFLD val1 val2 val3... The y-field values. See XFLD.</span>
0353                 ss = size(currentLineArray);
0354                 nFieldPoint = ss(1)-1; <span class="comment">% number of field points defined</span>
0355                 mySystem.NumberOfFieldPoints = nFieldPoint;
0356                 mySystem.FieldPointMatrix(:,2)= str2num((currentLineArray(2:ss(1)))');        
0357             <span class="keyword">case</span> <span class="string">'ZVCX'</span> <span class="comment">% ZVCX val1 val2 val3... The VCX vignetting factors.</span>
0358                 disp(<span class="string">'ZVCX is not supported!!'</span>);
0359             <span class="keyword">case</span> <span class="string">'ZVCY'</span> <span class="comment">% ZVCY val1 val2 val3... The VCY vignetting factors.</span>
0360                 disp(<span class="string">'ZVCY is not supported!!'</span>);
0361             <span class="keyword">case</span> <span class="string">'ZVDX'</span> <span class="comment">% ZVDX val1 val2 val3... The VDX vignetting factors.</span>
0362                 disp(<span class="string">'ZVDX is not supported!!'</span>);
0363             <span class="keyword">case</span> <span class="string">'ZVDY'</span> <span class="comment">% ZVDY val1 val2 val3... The VDY vignetting factors.</span>
0364                 disp(<span class="string">'ZVDY is not supported!!'</span>);
0365             <span class="keyword">otherwise</span>
0366                 disp([zmxCommand,<span class="string">' : UNKNOWN command found!!'</span>]);
0367         <span class="keyword">end</span>
0368                 
0369        <span class="comment">% read the next valid line</span>
0370 <span class="comment">%        currentPos = ftell(inputFile);</span>
0371 <span class="comment">%        fseek(inputFile,1,currentPos);</span>
0372        skippedLine = 0;
0373        currentLine = <a href="#_sub1" class="code" title="subfunction nextLine =  readNextLine(inputFile,skippedLine)">readNextLine</a>(inputFile,skippedLine);
0374     <span class="keyword">end</span>
0375     mySystem.NumberOfSurface =  nSurf;
0376     mySystem.SurfaceArray(1).ObjectSurface = 1;
0377     mySystem.SurfaceArray(nSurf).ImageSurface = 1;
0378     
0379     opticalSystemObject = mySystem; 
0380 <span class="keyword">end</span>
0381 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%</span>
0382 <a name="_sub1" href="#_subfunctions" class="code">function nextLine =  readNextLine(inputFile,skippedLine)</a>
0383     line = (fgets(inputFile));
0384     <span class="keyword">if</span> length(line)&lt; 4 &amp;&amp; skippedLine &lt; 5
0385         <span class="comment">% invalid line just skip</span>
0386         skippedLine = skippedLine + 1;
0387         nextLine =  <a href="#_sub1" class="code" title="subfunction nextLine =  readNextLine(inputFile,skippedLine)">readNextLine</a>(inputFile,skippedLine);
0388         
0389     <span class="keyword">end</span>
0390 
0391     <span class="keyword">if</span> ischar(line) &amp;&amp; skippedLine &lt; 5
0392         nxtL = strtrim(line);
0393         <span class="comment">% nxtL(2:2:length(nxtL)) = '';</span>
0394     <span class="keyword">else</span>
0395         nxtL = <span class="string">'EOF'</span>;
0396     <span class="keyword">end</span>
0397     
0398     nextLine = nxtL;
0399     
0400 <span class="keyword">end</span>
0401 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%</span></pre></div>
<hr><address>Generated on Thu 22-May-2014 16:03:22 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>